var param_module = require('mvc/params');

module.exports = function(Context, gate) {
    Context.prototype.flash = function(message, type, redirect_target) {
	if (!type) {
	    type = 'info';
	}
	this.request.flash(type, message);
	if (redirect_target) {
	    this.redirect(redirect_target);
	}
    }

    Context.prototype.redirect = function(target) {
	this.response.redirect(target);
    }

    Context.prototype.params = function(params) {
	return param_module(this.controller.name, params);
    }

    Context.prototype.render = function(path, options) {
	if (!path) {
	    path = this.controller._views[this.action];
	} else if (typeof(path) == 'object') {
	    options = path;
	    path = this.controller._views[this.action];
	}

	console.log(__filename, ': render: path = ', path);
	this.response.render(path, options);
    }
    
    gate.task_done();
}