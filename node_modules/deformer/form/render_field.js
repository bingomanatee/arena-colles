var ejs = require('ejs');
var path_module = require('path');
var fs = require('fs');

module.exports = function(self, field) {

    if (!field.type) {
        field.type = 'text';
    }

    if (!field.hasOwnProperty('label')) {
        field.label = self.labellize(field.name);
    }

    var template_path = self._template_path(self, field);

    if (!path_module.existsSync(template_path)) {
        throw new Error(__filename + ': cannot find template ' + template_path);
    }

    var template_file = fs.readFileSync(template_path, 'utf8');
    // console.log(__filename, '::render_field - ', field, ' rendering template ', template_path, ': ', template_file);
    try {
        field.rendered = ejs.render(template_file, {
            locals: {
                form: this,
                field: field
            }
        });
    } catch (err) {
        // console.log(__filename, ':: render_field error with field ', field.name, err);
    }
    // console.log(__filename, ':: render_field -- done with field', field.name)
}