function _fix_series(series) {
    if (series[0] === null) {
        series[0] = series[1];
    }
    if (series[3] === null) {
        series[3] = series[2];
    }
}

function _spline_series(series) {
    var value_i_1;
    var value_i_2;
    value_i_1 = (series[1] - series[0]) / 2 + series[1];
    value_i_2 = (series[2] - series[3]) / 2 + series[2];
    return Math.round((value_i_1 + value_i_2) / 2);
}

module.exports = function () {
    var Grid = require('./index');
    var d_grid = new Grid([], this.rows * 2 - 1, this.cols * 2 - 1);
    var r;
    var c;

    for (r = 0; r < this.rows; ++r) {
        for (c = 0; c < this.cols; ++c) {
            d_grid.set_value(r * 2, c * 2, this.get_value(r, c));
        }
    }

    // spline interpolate the horizontal points between every two columns
    for (r = 1; r < d_grid.rows; r += 2) {
        for (c = 0; c < d_grid.cols; c += 2) {
            var series = [d_grid.get_value(r - 2, c),
                d_grid.get_value(r - 1, c),
                d_grid.get_value(r + 1, c),
                d_grid.get_value(r + 2, c)];
            _fix_series(series);
            d_grid.set_value(r, c, _spline_series(series));
        }
    }

    // spline interpolate the vertical points between every two rows
    for (r = 0; r < d_grid.rows; r += 2) {
        for (c = 1; c < d_grid.cols; c += 2) {
            var series = [d_grid.get_value(r, c - 2),
                d_grid.get_value(r, c - 1),
                d_grid.get_value(r, c + 1),
                d_grid.get_value(r, c + 2)];
            _fix_series(series);
            d_grid.set_value(r, c, _spline_series(series));
        }
    }

    // average the newly created points to find the middle point
    // not strictly splinish but close enough for now.
    for (r = 1; r < d_grid.rows; r += 2) {
        for (c = 1; c < d_grid.cols; c += 2) {
            var series = [d_grid.get_value(r, c - 1),
                d_grid.get_value(r, c + 1),
                d_grid.get_value(r - 1, c),
                d_grid.get_value(r + 1, c)];
            var total = 0;
            var count = 0;
            series.forEach(function (v) {
                if (!(v === null)) {
                    total += v;
                    ++count;
                }
            });
            d_grid.set_value(r, c, Math.round(total / count));
        }
    }

    return d_grid;
}