var fs = require('fs');
var path = require('path');

module.exports = {
    /**
     * ensures every dir in the path
     * note - MUST begin with '/' and seperate with '/'
     * NO TRAILING '/'.
     *
     *  note also that existsSync can be fooled because it detects files OR
     *  directories. 
     */
    ensure_dir: function(dir, mode){
        if (!mode) mode = 0775;
       var dirs = dir.split('/');
       console.log(__filename, ': ', dir);
       
       for (var sets = 2; sets <= dirs.length; ++sets){
            _ensure_dir(dirs.slice(0, sets).join('/'), mode);
       }
    }
    
}

function _ensure_dir(dir, mode){
   //     console.log(__filename, ': ensuring ', dir);
        if (!path.existsSync(dir)){
     //       console.log('making');
            fs.mkdirSync(dir, mode);
            if (!path.existsSync(dir)){
                throw new Error(__filename, ': cannot create ' + dir);
            }
        }
}