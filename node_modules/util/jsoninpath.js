var path_module = require('path');
var fs = require('fs');

/**
 * Returns the content of all JSON files
 * within the path -- or the paths themselves --
 * depending on the content setting
 */

module.exports = function(path, get_content) {
    if (!path_module.existsSync(path)) {
        console.log(__filename, ': bad path ', path);
        throw new Error(__filename + ': ' + path + ' does not exist: ');
    }

    function _read_json(file) {
        var file_path = path + '/' + file;
        var data = fs.readFileSync(file_path);
        return JSON.parse(typeof(data) == 'string' ? data : data.toString());
    }
    
    function _paths(file){
        return path + '/' + file;
    }

    function _json_files(files, no_ext) {
        var out = _.filter(files, _is_json);
        return _.map(out, get_content? _read_json : _paths);
    }

    var files = fs.readdirSync(path);
    files = _json_files(files);
}

var jsext = /\.json$/;

function _is_json(f) {
    return jsext.test(f);
}

function _no_ext(f) {
    return f.replace(jsext, '');
}