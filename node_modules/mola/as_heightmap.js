var Canvas = require('canvas');
var Math_utils = require('util/math');

module.exports = function(min, max) {
    var self = this;
    
    console.log('min: ', min, ', max: ', max);
        
    var scale = 255 / (max - min);
    console.log('scale: ', scale);

    var canvas = new Canvas(this.get_cols(), this.get_rows());
    console.log('NEW CANVAS SIZE - H', canvas.width, canvas.height);
    var ctx = canvas.getContext('2d');
    var id = ctx.createImageData(canvas.width, canvas.height);
    
    var base = 0;
    var sample = [];
    
    this.data.forEach(function(height, i) {
        var h = (height - min) * scale;
        var shade = Math_utils.clamp(h, 0, 255, true);
        if (!(i % 50)){
            sample.push(height);
            console.log('height: ', height, 'h: ', h,  ', shade: ', shade);
        }

        id.data[base] = id.data[base + 1] = id.data[base + 2] = shade;
        id.data[base + 3] = 255;

        base += 4;
        // oninc(base, 1000000, _c);
    });

    console.log('min: ', Math.min.apply(Math, sample));
    console.log('max: ', Math.max.apply(Math, sample));
    
    ctx.putImageData(id, 0, 0);
    console.log('done drawing image data');
    return canvas;
}