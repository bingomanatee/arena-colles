<script language="javascript" src="http://localhost:4000/socket.io/socket.io.js">
</script>
<script language="javascript" src="/js/jquery.cookie.js">
</script>
<script language="javascript">

    var sid = '<%- sid %>';

    function _render_map_data(map_data){
        var render = $("#data_render");
        var data_range = 1000; // map_data.max - map_data.min;
        map_data.data.data.forEach(function(series, row_index){

            series.forEach(function(height, col_index){
                if ((row_index == 0) || (col_index == 0)){
                    var height_percent = 0.5;
                } else {
                    var north_heights = map_data.data.data[row_index - 1][col_index - 1] * 2;
                    north_heights += map_data.data.data[row_index][col_index - 1] ;
                    north_heights += map_data.data.data[row_index- 1][col_index ] ;
                    var hp = (north_heights / 4) - height;
                    hp /= 100;
                    hp += 0.5;
                }
                render.append('<div style="position:absolute;' +
                        ' background-color: rgba(0, 0, 0, ' + hp + '); width: 2px; height: 2px; overflow: hidden;' +
                        ' left:' + (col_index * 2) + 'px; top: ' + (row_index * 2) + 'px">&nbsp;</div>');
            });
        });
    }


    $(document).ready(
            function () {
                $('#sid').append('Session ID: ', sid);

                var socket = io.connect('http://localhost:4000');
                socket.on('connect', function () {

                    var map_req = {sid: sid,
                        erode: true,
                        lat: Math.floor(Math.random() * -44),
                        lon: Math.floor((Math.random() * 90) + 180)};
                    console.log('MAP REQUEST: lat ', map_req.lat, ', lon: ', map_req.lon);
                    var start_time = new Date().getTime();
                    socket.emit('map_data_req', map_req);
                   // socket.emit('map_data_req', {sid: sid, lat: -36, lon: 251});

                    socket.on('map_data', function (map_data) {
                        console.log('time to get: ', new Date().getTime() - start_time);
                        console.log('Map Data: ', map_data);
                        _render_map_data(map_data);
                    });

                })
            }
    )
</script>

<h2>Session ID</h2>
<p id="sid">...</p>

<div id="data_render" style="position: relative; width: 640px; height: 640px; border: 1px solid black">


</div>