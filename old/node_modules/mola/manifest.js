var pm = require('path');
var fs = require('fs');

function _find_topo(file) {
    //    console.log('file ', file.notes);
  //  console.log('name: ', file.notes.name);
    var p = /MEDIAN_TOPOGRAPHY/.test(file.notes.name);
  //  console.log('PASS: ', p);
    return p;
}

module.exports = function(path) {
    if (!/^\//.test(path)) {
        path = MVC_ROOT + '/' + path;
    }
    if (!/manifest\.json$/.test(path)) {
        if (!/\/$/.test(path)) {
            path += '/';
        }
        path += 'manifest.json';
    }

    console.log(__filename, ' -- manifest: ', path);
    if (!pm.existsSync(path)) {
        throw new Error('no manifest file ', path);
    }

    try {
        var manifest = JSON.parse(fs.readFileSync(path));
    } catch (e) {
        console.log('error parsing ', path);
        throw e;
    }

    manifest.manifest = _.select(manifest.manifest, _find_topo);

    return manifest;
}